{% extends 'base.html' %}
{% block title %}{% endblock title %} 
{% load static %}
{% block head %}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.6.0/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="{% static 'js/posts_detail_map.js' %}" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="{% static 'css/schedule_detail.css' %}"> 
{% endblock head %}
{% block content %}
<div class="p-5">
<h2>내 일정</h2>
<p>캠핑 장소: <a href="{% url 'posts:detail' post_pk=schedule.post.pk %}">{{ schedule.title }}</a></p>
<p>시작일: {{ schedule.start }}</p
<p>종료일: {{ schedule.end }}</p>
<p>메모: {{ schedule.description }}</p>
<p class="map m-0 p-0" id="map" style="width:400px; height:400px;" data-longitude="{{ longitude }}" data-latitude="{{ latitude }}"></p>
<a href="" onclick="printThis(); return false;" class="icon-btn"><i class="bi bi-printer"></i></a>
</div>
{% endblock content %}
{% block script %}
<script src='{% static "js/index.global.js" %}'></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{ kakao_script_key }}&libraries=services"></script>
<script>
  function copy_trackback(url) {
    var tempInput = document.createElement('input');
    tempInput.value = url;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);
    alert('URL이 복사되었습니다.');
  }
  
  function printThis() {
    window.print();
  }
</script>
<script>
  document.getElementById("map-btn").addEventListener("click", function() {
    const apiKey = "{{ kakao_key }}";
    const apiUrl = "https://dapi.kakao.com/v2/local/geo/transcoord.json?x=127.423084&y=37.078956&input_coord=WGS84&output_coord=TM";
  
    fetch(apiUrl, {
      headers: {
        "Authorization": "KakaoAK " + apiKey
      }
    })
    .then(response => response.json())
    .then(data => {
      const latitude = "{{ latitude }}";
      const longitude = "{{ longitude }}";
      const title = "{{ title }}";
  
      const directionsUrl = "https://map.kakao.com/link/to/" + title + "," + latitude + "," + longitude;
    
      window.open(directionsUrl, "_blank");
    })
    .catch(error => {
      console.log(error);
    });
  });
  
</script>
{% endblock script %}
